#include "Extensions/Hack Installation.txt"
#include "Extensions/6CDefinitions.txt"

#include "Movement Arrow EA.txt"
#include "FE8-Buy Units/FE8-Buy Unit EA.txt"

PUSH

//Set guard tile ai after moving and don't set bit 2 of status word if wagon
ORG $18750
callHack_r3(End_Unit_Action)

//When player phase ends and the 'has moved' bits are being unset, write guard tile ai
ORG $1882C
callHack_r0(End_Phase_Set_Guard)

//Everyone can access Supply
ORG $23F64
SHORT 0x2001 0x4770

//Make sure class+char bases are >=0
ORG $17E64
callHack_r3(No_Negative_Stats)

//Make NPC phase not appear (set eligible unit count to 0, basically)
ORG $24CEC
jumpToHack(No_Eligible_NPCs)

//Really friggin' tired of no$ crashing when trying to decompress bad data, so here's a fix
ORG $12F50
jumpToHack(Decompress_Fix)

//Make Dance multi-target
ORG $23238 //without rings
callHack_r3(Dance1)
ORG $24AFC //with rings
callHack_r3(Dance1)
SHORT 0
ORG $32358 //action
jumpToHack(Dance_Action)
//Dancers can't dance other dancers
ORG $25B40
callHack_r3(Dancer_Check)
SHORT 0x2800

//Make dancer rings refresh
ORG $2FC20
callHack_r3(Dancer_Rings)

//AI
ORG $5A8BA4
SHORT SittingDuck
ORG $D810C
POIN New_AI|1

//Relocate item
ORG ItemUsabilityTable + 4*(Relocate - 0x4B)
POIN Relocate_Usability
ORG ItemEffectTable + 4*(Relocate - 0x4B)
POIN Relocate_Effect

POP

ALIGN 4
End_Unit_Action:
#incbin "End_Unit_Action.dmp"

ALIGN 4
End_Phase_Set_Guard:
#incbin "End_Phase_Set_Guard.dmp"

ALIGN 4
No_Negative_Stats:
#incbin "No_Negative_Stats.dmp"

ALIGN 4
No_Eligible_NPCs:
#incbin "No_Eligible_NPCs.dmp"

ALIGN 4
Decompress_Fix:
#incbin "Decompress_Fix.dmp"

ALIGN 4
Get_Enemies:
#incbin "Get_Enemies.dmp"
POIN Enemy_Pointer_Table

ALIGN 4
MESSAGE new ai at CURRENTOFFSET
New_AI:
#incbin "New_AI.dmp"
POIN Can_Unit_Steal

ALIGN 4
Dance1:
#incbin "Dance1.dmp"

ALIGN 4
Dance_Action:
#incbin "Dance_Action.dmp"

ALIGN 4
Dancer_Rings:
#incbin "Dancer_Rings.dmp"

ALIGN 4
Dancer_Check:
#incbin "Dancer_Check.dmp"

ALIGN 4
Relocate_Usability:
#incbin "Relocate_Usability.dmp"

ALIGN 4
Relocate_Effect:
#incbin "Relocate_Effect.dmp"
